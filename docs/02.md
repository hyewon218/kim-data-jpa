# ì˜ˆì œ ë„ë©”ì¸ ëª¨ë¸
## ì˜ˆì œ ë„ë©”ì¸ ëª¨ë¸ê³¼ ë™ì‘í™•ì¸
#### ì—”í‹°í‹° í´ë˜ìŠ¤
<img src="https://github.com/hyewon218/kim-data-jpa/assets/126750615/85e5deae-31f3-4abe-9ac5-0f183e0360cb" width="60%"/><br>
#### ERD
<img src="https://github.com/hyewon218/kim-data-jpa/assets/126750615/c1cff4ab-aa1c-4b06-b514-2a798338d51e" width="60%"/><br>

#### Member ì—”í‹°í‹°
```java
@Entity
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@ToString(of = {"id", "username", "age"}) // ê°ì²´ë¥¼ ì°ì„ ë•Œ ì¶œë ¥ ë¨
public class Member {

    @Id
    @GeneratedValue
    @Column(name = "member_id")
    private Long id;
    private String username;
    private int age;
    
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "team_id")
    private Team team;

    public Member(String username) {
        this.username = username;
    }
    
    public Member(String username, int age) {
        this(username, age, null);
    }
    
    public Member(String username, int age, Team team) {
        this.username = username;
        this.age = age;
        if (team != null) {
            changeTeam(team);
        }
    }

    // ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œ
    public void changeTeam(Team team) {
        this.team = team;
        team.getMembers().add(this);
    }
}
```
- ë¡¬ë³µ ì„¤ëª…
  - @Setter: ì‹¤ë¬´ì—ì„œ ê°€ê¸‰ì  SetterëŠ” ì‚¬ìš©í•˜ì§€ ì•Šê¸°
  - @NoArgsConstructor AccessLevel.PROTECTED: ê¸°ë³¸ ìƒì„±ì ë§‰ê³  ì‹¶ì€ë°, JPA ìŠ¤íŒ©ìƒ PROTECTEDë¡œ ì—´ì–´ë‘ì–´ì•¼ í•¨
  - @ToStringì€ ê°€ê¸‰ì  ë‚´ë¶€ í•„ë“œë§Œ(ì—°ê´€ê´€ê³„ ì—†ëŠ” í•„ë“œë§Œ)
- changeTeam() ìœ¼ë¡œ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ í•œë²ˆì— ì²˜ë¦¬(ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì†Œë“œ)
  - memberëŠ” teamì„ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.
  - teamì˜ memberì—ë„ ì„¸íŒ…ì„ ê±¸ì–´ì£¼ì—ˆë‹¤.
- `@ManyToOne` ê´€ê³„ ê¸°ë³¸ì ìœ¼ë¡œ EAGERë¡œ ë˜ì–´ìˆë‹¤. -> `LAZY`ë¡œ ê¼­ ë°”ê¿”ì£¼ê¸°

> jpaì—ì„œ ëª¨ë“  ì—°ê´€ê´€ê³„ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë‹¤ ì§€ì—°ë¡œë”©, ë ˆì´ì§€ë¡œ ë‹¤ ì„¸íŒ…ì„ í•´ì•¼í•¨<br>
> ì¦‰ì‹œë¡œë”©(eager)ê°€ ê±¸ë ¤ìˆìœ¼ë©´ ì„±ëŠ¥ìµœì í™”í•˜ê¸° êµ‰ì¥íˆ ì–´ë µë‹¤!<br>
> ì‹¤ë¬´ì—ì„œëŠ” ì›¬ë§Œí•˜ë©´ ë‹¤ ë ˆì´ì§€ë¡œ ì„¸íŒ…ì„ í•´ë‘¬ì•¼ í•¨!

#### Team ì—”í‹°í‹°
```java
@Entity
@Getter
@Setter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@ToString(of = {"id", "name"})
public class Team {

    @Id
    @GeneratedValue
    @Column(name = "team_id")
    private Long id;
    private String name;

    @OneToMany(mappedBy = "team")
    List<Member> members = new ArrayList<>();

    public Team(String name) {
        this.name = name;
    }
}
```
#### ë°ì´í„° í™•ì¸ í…ŒìŠ¤íŠ¸
```java
@SpringBootTest
public class MemberTest {

    @PersistenceContext
    EntityManager em;

    @Test
    @Transactional
    @Rollback(false)
    public void testEntity() {

        Team teamA = new Team("teamA");
        Team teamB = new Team("teamB");
        em.persist(teamA);
        em.persist(teamB);

        Member member1 = new Member("member1", 10, teamA);
        Member member2 = new Member("member2", 20, teamA);
        Member member3 = new Member("member3", 30, teamB);
        Member member4 = new Member("member4", 40, teamB);

        em.persist(member1);
        em.persist(member2);
        em.persist(member3);
        em.persist(member4);

        //ì´ˆê¸°í™”
        em.flush();
        em.clear();

        //í™•ì¸
        List<Member> members = em.createQuery("select m from Member m", Member.class)
            .getResultList();
        for (Member member : members) {
            System.out.println("member=" + member);
            System.out.println("-> member.team=" + member.getTeam());
        }
    }
}
```
- ê°€ê¸‰ì  ìˆœìˆ˜ JPAë¡œ ë™ì‘ í™•ì¸ (ë’¤ì—ì„œ ë³€ê²½) 
- db í…Œì´ë¸” ê²°ê³¼ í™•ì¸
- ì§€ì—° ë¡œë”© ë™ì‘ í™•ì¸

<img src="https://github.com/hyewon218/kim-data-jpa/assets/126750615/5dd190b3-a2b5-4c2a-b86a-3bbc6ebd1dd6" width="60%"/><br>
- ì§€ì—° ë¡œë”© í™•ì¸ - member1 ì¡°íšŒ í›„ team ì¡°íšŒ
> ğŸ“Œ ì§€ì—° ë¡œë”©<br>
> member ì¡°íšŒí•  ë•Œ memberë§Œ ì¡°íšŒ, teamì€ ê°€ì§œ ê°ì²´ë¡œ ê°€ì§€ê³  ìˆë‹¤ê°€ ê°’ì„ ì‹¤ì œë¡œ ì‚¬ìš©í•  ë•Œ DBì—ì„œ ì¿¼ë¦¬í•´ ì˜¨ë‹¤.

<br><img src="https://github.com/hyewon218/kim-data-jpa/assets/126750615/177c5ecd-8454-49a5-9b81-0262800878fb" width="60%"/><br>
